#include "config.h"

namespace TactsuitVR {

	int magicsleepduration = 250;
	int bowsleepduration = 100;

	int rainvestsleepduration = 1000;
	int rainheadsleepduration = 1000;
	int rainarmsleepduration = 1000;
	int raineffectduration = 50;

	int swimmingsleepduration=300;

	int horseridingsleepduration = 3000;

	int leftHandedMode = 0;
	
	int logging = 1;

	int useShooterPosition = 0;

	int processVisualEffects = 1;

	int UseControllerHapticsForEnvironmentAttack = 1;
	int UseControllerHapticsForHitEffects = 1;

	int WindEffectMinSpeed = 100;

	float FallEffectMinHeight = 100.0f;

	float intensityMultiplierMagic = 1.0f;
	float intensityMultiplierShout = 1.0f;
	float intensityMultiplierRanged = 1.0f;

	float intensityMultiplierMeleePowerAttack = 1.0f;
	float intensityMultiplierMeleeBash = 1.0f;
	float intensityMultiplierMeleeAxe = 1.0f;
	float intensityMultiplierMeleeDagger = 1.0f;
	float intensityMultiplierMeleeMace = 1.0f;
	float intensityMultiplierMeleeSword = 1.0f;
	float intensityMultiplierMelee2HAxe = 1.0f;
	float intensityMultiplierMelee2HSword = 1.0f;
	float intensityMultiplierMeleeFist = 1.0f;

	float intensityMultiplierBite = 1.0f;
	float intensityMultiplierDefault = 1.0f;

	float lowhealthpercentage = 0.2f;
	float verylowhealthpercentage = 0.1f;

	float intensityMultiplierHeartBeatFast = 1.0f;
	float intensityMultiplierHeartBeat = 1.0f;

	float intensityMultiplierWordWall = 1.0f;
	float intensityMultiplierDragonSoul = 1.0f;

	float intensityMultiplierRaindropVest = 1.0f;
	float intensityMultiplierRaindropArm = 1.0f;
	float intensityMultiplierRaindropHead = 1.0f;

	float intensityMultiplierPlayerShout = 1.0f;
	float intensityMultiplierPlayerSpell = 1.0f;
	float intensityMultiplierPlayerStaff = 1.0f;
	float intensityMultiplierPlayerBlock = 1.0f;
	float intensityMultiplierPlayerPowerAttack = 1.0f;
	float intensityMultiplierPlayerBash = 1.0f;
	float intensityMultiplierPlayerAttack = 1.0f;
	float intensityMultiplierPlayerBowPullRight = 0.2f;
	float intensityMultiplierPlayerBowPullLeft = 0.4f;
	float intensityMultiplierPlayerBowHold = 0.3f;
	float intensityMultiplierPlayerEnvironmentAttack = 0.9f;

	float intensityMultiplierPlayerSwimming = 1.0f;

	float intensityMultiplierDrink = 1.0f;
	float intensityMultiplierEat = 1.0f;

	float intensityMultiplierShoutFire = 1.0f;
	float intensityMultiplierShoutFireball = 1.0f;
	float intensityMultiplierShoutFrost = 1.0f;
	float intensityMultiplierShoutSteam = 1.0f;
	float intensityMultiplierShoutLightning = 1.0f;
	float intensityMultiplierHiggsPull = 1.0f;
	float intensityMultiplierPlayerEnvironmentHit = 1.0f;
	float intensityMultiplierPlayerThrow = 1.0f;
	float intensityMultiplierPlayerCatch = 1.0f;
	
	float intensityMultiplierSpellWheelOpen = 1.0f;

	float intensityMultiplierTravelEffect = 1.0f;
	float intensityMultiplierTeleport = 1.0f;

	float intensityMultiplierPlayerShoutBind = 1.0f;

	float intensityMultiplierPlayerPower = 1.0f;

	float intensityMultiplierHolster = 1.0f;

	float intensityMultiplierEnvironmentRumble = 1.0f;
	float intensityMultiplierDragonLanding = 1.0f;

	float intensityMultiplierEquipUnequip = 1.0f;

	float intensityMultiplierLearned = 1.0f;

	float intensityMultiplierArrowShoulderEquip = 1.0f;

	float intensityMultiplierExplosion = 1.0f;
	float intensityMultiplierEnvironmentalPoison = 1.0f;
	float intensityMultiplierEnvironmentalFire = 1.0f;
	float intensityMultiplierEnvironmentalShock = 1.0f;
	float intensityMultiplierEnvironmentalFrost = 1.0f;


	float intensityMultiplierUnarmedDefault = 1.0f;
	float intensityMultiplierUnarmedDragon = 1.0f;
	float intensityMultiplierUnarmedFrostbiteSpider = 1.0f;
	float intensityMultiplierUnarmedSabreCat = 1.0f;
	float intensityMultiplierUnarmedSkeever = 1.0f;
	float intensityMultiplierUnarmedSlaughterfish = 1.0f;
	float intensityMultiplierUnarmedWisp = 1.0f;
	float intensityMultiplierUnarmedDragonPriest = 1.0f;
	float intensityMultiplierUnarmedDraugr = 1.0f;
	float intensityMultiplierUnarmedWolf = 1.0f;
	float intensityMultiplierUnarmedGiant = 1.0f;
	float intensityMultiplierUnarmedIceWraith = 1.0f;
	float intensityMultiplierUnarmedChaurus = 1.0f;
	float intensityMultiplierUnarmedMammoth = 1.0f;
	float intensityMultiplierUnarmedFrostAtronach = 1.0f;
	float intensityMultiplierUnarmedFalmer = 1.0f;
	float intensityMultiplierUnarmedHorse = 1.0f;
	float intensityMultiplierUnarmedStormAtronach = 1.0f;
	float intensityMultiplierUnarmedElk = 1.0f;
	float intensityMultiplierUnarmedDwarvenSphere = 1.0f;
	float intensityMultiplierUnarmedDwarvenSteam = 1.0f;
	float intensityMultiplierUnarmedDwarvenSpider = 1.0f;
	float intensityMultiplierUnarmedBear = 1.0f;
	float intensityMultiplierUnarmedFlameAtronach = 1.0f;
	float intensityMultiplierUnarmedWitchlight = 1.0f;
	float intensityMultiplierUnarmedHorker = 1.0f;
	float intensityMultiplierUnarmedTroll = 1.0f;
	float intensityMultiplierUnarmedHagraven = 1.0f;
	float intensityMultiplierUnarmedSpriggan = 1.0f;
	float intensityMultiplierUnarmedMudcrab = 1.0f;
	float intensityMultiplierUnarmedWerewolf = 1.0f;
	float intensityMultiplierUnarmedChaurusFlyer = 1.0f;
	float intensityMultiplierUnarmedGargoyle = 1.0f;
	float intensityMultiplierUnarmedRiekling = 1.0f;
	float intensityMultiplierUnarmedScrib = 1.0f;
	float intensityMultiplierUnarmedSeeker = 1.0f;
	float intensityMultiplierUnarmedMountedRiekling = 1.0f;
	float intensityMultiplierUnarmedNetch = 1.0f;
	float intensityMultiplierUnarmedBenthicLurker = 1.0f;

	float intensityMultiplierDefaultHead = 1.0f;
	float intensityMultiplierUnarmedHead = 1.0f;
	float intensityMultiplierRangedHead = 1.0f;
	float intensityMultiplierMeleeHead = 1.0f;
	float intensityMultiplierMagicHead = 1.0f;

	float intensityMultiplierMagicArm = 1.0f;
	float intensityMultiplierRangedArm = 1.0f;

	float intensityMultiplierHorseRidingSlow = 1.0f;
	float intensityMultiplierHorseRiding = 1.0f;

	float intensityMultiplierFallEffect = 1.0f;

	float intensityMultiplierWindEffect = 1.0f;
	float intensityMultiplierBlizzardEffect = 1.0f;

	float intensityMultiplierDrowningVest = 1.0f;
	float intensityMultiplierDrowningHead = 1.0f;

	float intensityMultiplierPlayerCrossbowFire = 1.0f;
	float intensityMultiplierPlayerCrossbowKickback = 1.0f;

	float intensityMultiplierMagicArmorSpell = 1.0f;
	float intensityMultiplierSoulTrap = 1.0f;

	std::vector<std::string> ignoredSpells;
	std::vector<std::string> shortSpells;

	void loadConfig()
	{
		std::string	runtimeDirectory = GetRuntimeDirectory();

		if (!runtimeDirectory.empty())
		{
			std::string filepath = runtimeDirectory + "Data\\SKSE\\Plugins\\tactsuit_vr_plugin.ini";

			std::ifstream file(filepath);

			if (!file.is_open())
			{
				transform(filepath.begin(), filepath.end(), filepath.begin(), ::tolower);
				file.open(filepath);
			}

			if (file.is_open())
			{
				std::string line;
				std::string currentSetting;
				while (std::getline(file, line))
				{
					//trim(line);
					skipComments(line);
					trim(line);
					if (line.length() > 0)
					{
						if (line.substr(0, 1) == "[")
						{
							//newsetting
							currentSetting = line;
						}
						else
						{
							if (currentSetting == "[Setting]")
							{
								std::string variableName;
								int variableValue = GetConfigSettingsValue(line, variableName);
								if (variableName == "MagicSleepDuration")
								{
									magicsleepduration = variableValue;
								}
								else if (variableName == "BowSleepDuration")
								{
									bowsleepduration = variableValue;
								}
								else if (variableName == "RainVestSleepDuration")
								{
									rainvestsleepduration = variableValue;
								}
								else if (variableName == "RainHeadSleepDuration")
								{
									rainheadsleepduration = variableValue;
								}
								else if (variableName == "RainArmSleepDuration")
								{
									rainarmsleepduration = variableValue;
								}
								else if (variableName == "RainEffectDuration")
								{
									raineffectduration = variableValue;
								}
								else if (variableName == "SwimmingSleepDuration")
								{
									swimmingsleepduration = variableValue;
								}
								else if (variableName == "HorseRidingSleepDuration")
								{
									horseridingsleepduration = variableValue;
								}								
								else if (variableName == "Logging")
								{
									logging = variableValue;
								}
								else if (variableName == "UseShooterPosition")
								{
									useShooterPosition = variableValue;
								}
								else if (variableName == "ProcessVisualEffects")
								{
									processVisualEffects = variableValue;
								}
								else if (variableName == "UseControllerHapticsForEnvironmentAttack")
								{
									UseControllerHapticsForEnvironmentAttack = variableValue;
								}						
								else if (variableName == "FallEffectMinHeight")
								{
									FallEffectMinHeight = variableValue;
								}
								else if (variableName == "WindEffectMinSpeed")
								{
									WindEffectMinSpeed = variableValue;
								}
								
								else if (variableName == "LowHealthPercentage")
                                {
									lowhealthpercentage = (float)(variableValue) /100.0f;
								}
								else if (variableName == "VeryLowHealthPercentage")
								{
									verylowhealthpercentage = (float)(variableValue) / 100.0f;
                                }
							}
							else if (currentSetting == "[Intensity]")
							{
								std::string variableName;
								float variableValue = GetConfigSettingsFloatValue(line, variableName);
								if (variableName == "Magic")
									intensityMultiplierMagic = variableValue;
								else if (variableName == "Shout")
									intensityMultiplierShout = variableValue;
								else if (variableName == "Ranged")
									intensityMultiplierRanged = variableValue;
								else if (variableName == "MeleePowerAttack")
									intensityMultiplierMeleePowerAttack = variableValue;
								else if (variableName == "MeleeBash")
									intensityMultiplierMeleeBash = variableValue;
								else if (variableName == "MeleeAxe")
									intensityMultiplierMeleeAxe = variableValue;
								else if (variableName == "MeleeDagger")
									intensityMultiplierMeleeDagger = variableValue;
								else if (variableName == "MeleeMace")
									intensityMultiplierMeleeMace = variableValue;
								else if (variableName == "MeleeSword")
									intensityMultiplierMeleeSword = variableValue;
								else if (variableName == "Melee2HAxe")
									intensityMultiplierMelee2HAxe = variableValue;
								else if (variableName == "Melee2HSword")
									intensityMultiplierMelee2HSword = variableValue;
								else if (variableName == "MeleeFist")
									intensityMultiplierMeleeFist = variableValue;
								else if (variableName == "Bite")
									intensityMultiplierBite = variableValue;
								else if (variableName == "Default")
									intensityMultiplierDefault = variableValue;
								else if (variableName == "HeartBeatFast")
									intensityMultiplierHeartBeatFast = variableValue;
								else if (variableName == "HeartBeat")
									intensityMultiplierHeartBeat = variableValue;
								else if (variableName == "WordWall")
									intensityMultiplierWordWall = variableValue;
								else if (variableName == "DragonSoul")
									intensityMultiplierDragonSoul = variableValue;
								else if (variableName == "RaindropVest")
									intensityMultiplierRaindropVest = variableValue;
								else if (variableName == "RaindropArm")
									intensityMultiplierRaindropArm = variableValue;
								else if (variableName == "RaindropHead")
									intensityMultiplierRaindropHead = variableValue;
								else if (variableName == "PlayerShout")
									intensityMultiplierPlayerShout = variableValue;
								else if (variableName == "PlayerSpell")
									intensityMultiplierPlayerSpell = variableValue;
								else if (variableName == "PlayerStaff")
									intensityMultiplierPlayerStaff = variableValue;
								else if (variableName == "PlayerBlock")
									intensityMultiplierPlayerBlock = variableValue;
								else if (variableName == "PlayerPowerAttack")
									intensityMultiplierPlayerPowerAttack = variableValue;
								else if (variableName == "PlayerBash")
									intensityMultiplierPlayerBash = variableValue;
								else if (variableName == "PlayerAttack")
									intensityMultiplierPlayerAttack = variableValue;
								else if (variableName == "PlayerEnvironmentAttack")
									intensityMultiplierPlayerEnvironmentAttack = variableValue;
								else if (variableName == "PlayerBowPullRight")
									intensityMultiplierPlayerBowPullRight = variableValue;
								else if (variableName == "PlayerBowPullLeft")
									intensityMultiplierPlayerBowPullLeft = variableValue;
								else if (variableName == "PlayerBowHold")
									intensityMultiplierPlayerBowHold = variableValue;
								else if (variableName == "PlayerSwimming")
									intensityMultiplierPlayerSwimming = variableValue;
								else if (variableName == "Drink")
									intensityMultiplierDrink = variableValue;
								else if (variableName == "Eat")
									intensityMultiplierEat = variableValue;
								else if (variableName == "Holster")
									intensityMultiplierHolster = variableValue;

								else if (variableName == "ShoutFire")
									intensityMultiplierShoutFire = variableValue;
								else if (variableName == "ShoutFireball")
									intensityMultiplierShoutFireball = variableValue;
								else if (variableName == "ShoutFrost")
									intensityMultiplierShoutFrost = variableValue;
								else if (variableName == "ShoutSteam")
									intensityMultiplierShoutSteam = variableValue;
								else if (variableName == "ShoutLightning")
									intensityMultiplierShoutLightning = variableValue;
								else if (variableName == "HiggsPull")
									intensityMultiplierHiggsPull = variableValue;
								else if (variableName == "HiggsCollide")
									intensityMultiplierPlayerEnvironmentHit = variableValue;
								else if (variableName == "WeaponThrow")
									intensityMultiplierPlayerThrow = variableValue;
								else if (variableName == "WeaponCatch")
									intensityMultiplierPlayerCatch = variableValue;
								else if (variableName == "SpellWheelOpen")
									intensityMultiplierSpellWheelOpen = variableValue;
								else if (variableName == "TravelEffect")
									intensityMultiplierTravelEffect = variableValue;
								else if (variableName == "Teleport")
									intensityMultiplierTeleport = variableValue;
								else if (variableName == "PlayerShoutBind")
									intensityMultiplierPlayerShoutBind = variableValue;
								else if (variableName == "EnvironmentRumble")
									intensityMultiplierEnvironmentRumble = variableValue;
								else if (variableName == "DragonLanding")
									intensityMultiplierDragonLanding = variableValue;
								else if (variableName == "EquipUnequip")
									intensityMultiplierEquipUnequip = variableValue;
								else if (variableName == "Learned")
									intensityMultiplierLearned = variableValue;
								else if (variableName == "ArrowShoulderEquip")
									intensityMultiplierArrowShoulderEquip = variableValue;
								else if (variableName == "PlayerPower")
									intensityMultiplierPlayerPower = variableValue;
								else if (variableName == "Explosion")
									intensityMultiplierExplosion = variableValue;
								else if (variableName == "EnvironmentalPoison")
									intensityMultiplierEnvironmentalPoison = variableValue;
								else if (variableName == "EnvironmentalFire")
									intensityMultiplierEnvironmentalFire = variableValue;
								else if (variableName == "EnvironmentalShock")
									intensityMultiplierEnvironmentalShock = variableValue;
								else if (variableName == "EnvironmentalFrost")
									intensityMultiplierEnvironmentalFrost = variableValue;

								else if (variableName == "UnarmedDefault") intensityMultiplierUnarmedDefault = variableValue;
								else if (variableName == "UnarmedDragon") intensityMultiplierUnarmedDragon = variableValue;
								else if (variableName == "UnarmedFrostbiteSpider") intensityMultiplierUnarmedFrostbiteSpider = variableValue;
								else if (variableName == "UnarmedSabreCat") intensityMultiplierUnarmedSabreCat = variableValue;
								else if (variableName == "UnarmedSkeever") intensityMultiplierUnarmedSkeever = variableValue;
								else if (variableName == "UnarmedSlaughterfish") intensityMultiplierUnarmedSlaughterfish = variableValue;
								else if (variableName == "UnarmedWisp") intensityMultiplierUnarmedWisp = variableValue;
								else if (variableName == "UnarmedDragonPriest") intensityMultiplierUnarmedDragonPriest = variableValue;
								else if (variableName == "UnarmedDraugr") intensityMultiplierUnarmedDraugr = variableValue;
								else if (variableName == "UnarmedWolf") intensityMultiplierUnarmedWolf = variableValue;
								else if (variableName == "UnarmedGiant") intensityMultiplierUnarmedGiant = variableValue;
								else if (variableName == "UnarmedIceWraith") intensityMultiplierUnarmedIceWraith = variableValue;
								else if (variableName == "UnarmedChaurus") intensityMultiplierUnarmedChaurus = variableValue;
								else if (variableName == "UnarmedMammoth") intensityMultiplierUnarmedMammoth = variableValue;
								else if (variableName == "UnarmedFrostAtronach") intensityMultiplierUnarmedFrostAtronach = variableValue;
								else if (variableName == "UnarmedFalmer") intensityMultiplierUnarmedFalmer = variableValue;
								else if (variableName == "UnarmedHorse") intensityMultiplierUnarmedHorse = variableValue;
								else if (variableName == "UnarmedStormAtronach") intensityMultiplierUnarmedStormAtronach = variableValue;
								else if (variableName == "UnarmedElk") intensityMultiplierUnarmedElk = variableValue;
								else if (variableName == "UnarmedDwarvenSphere") intensityMultiplierUnarmedDwarvenSphere = variableValue;
								else if (variableName == "UnarmedDwarvenSteam") intensityMultiplierUnarmedDwarvenSteam = variableValue;
								else if (variableName == "UnarmedDwarvenSpider") intensityMultiplierUnarmedDwarvenSpider = variableValue;
								else if (variableName == "UnarmedBear") intensityMultiplierUnarmedBear = variableValue;
								else if (variableName == "UnarmedFlameAtronach") intensityMultiplierUnarmedFlameAtronach = variableValue;
								else if (variableName == "UnarmedWitchlight") intensityMultiplierUnarmedWitchlight = variableValue;
								else if (variableName == "UnarmedHorker") intensityMultiplierUnarmedHorker = variableValue;
								else if (variableName == "UnarmedTroll") intensityMultiplierUnarmedTroll = variableValue;
								else if (variableName == "UnarmedHagraven") intensityMultiplierUnarmedHagraven = variableValue;
								else if (variableName == "UnarmedSpriggan") intensityMultiplierUnarmedSpriggan = variableValue;
								else if (variableName == "UnarmedMudcrab") intensityMultiplierUnarmedMudcrab = variableValue;
								else if (variableName == "UnarmedWerewolf") intensityMultiplierUnarmedWerewolf = variableValue;
								else if (variableName == "UnarmedChaurusFlyer") intensityMultiplierUnarmedChaurusFlyer = variableValue;
								else if (variableName == "UnarmedGargoyle") intensityMultiplierUnarmedGargoyle = variableValue;
								else if (variableName == "UnarmedRiekling") intensityMultiplierUnarmedRiekling = variableValue;
								else if (variableName == "UnarmedScrib") intensityMultiplierUnarmedScrib = variableValue;
								else if (variableName == "UnarmedSeeker") intensityMultiplierUnarmedSeeker = variableValue;
								else if (variableName == "UnarmedMountedRiekling") intensityMultiplierUnarmedMountedRiekling = variableValue;
								else if (variableName == "UnarmedNetch") intensityMultiplierUnarmedNetch = variableValue;
								else if (variableName == "UnarmedBenthicLurker") intensityMultiplierUnarmedBenthicLurker = variableValue;

								else if (variableName == "DefaultHead") intensityMultiplierDefaultHead = variableValue;
								else if (variableName == "UnarmedHead") intensityMultiplierUnarmedHead = variableValue;
								else if (variableName == "RangedHead") intensityMultiplierRangedHead = variableValue;
								else if (variableName == "MeleeHead") intensityMultiplierMeleeHead = variableValue;
								else if (variableName == "MagicHead") intensityMultiplierMagicHead = variableValue;

								else if (variableName == "MagicArm") intensityMultiplierMagicArm = variableValue;
								else if (variableName == "RangedArm") intensityMultiplierRangedArm = variableValue;

								else if (variableName == "HorseRiding") intensityMultiplierHorseRiding = variableValue;
								else if (variableName == "HorseRidingSlow") intensityMultiplierHorseRidingSlow = variableValue;
								
								else if (variableName == "FallEffect") intensityMultiplierFallEffect = variableValue;

								else if (variableName == "WindEffect") intensityMultiplierWindEffect = variableValue;
								else if (variableName == "BlizzardEffect") intensityMultiplierBlizzardEffect = variableValue;

								else if (variableName == "DrowningVest") intensityMultiplierDrowningVest = variableValue;
								else if (variableName == "DrowningHead") intensityMultiplierDrowningHead = variableValue;

								if (variableName == "PlayerCrossbowFire") intensityMultiplierPlayerCrossbowFire = variableValue;								
								else if (variableName == "PlayerCrossbowKickback") intensityMultiplierPlayerCrossbowKickback = variableValue;
								else if (variableName == "MagicArmorSpell") intensityMultiplierMagicArmorSpell = variableValue;
								else if (variableName == "SoulTrapEffect") intensityMultiplierSoulTrap = variableValue;
								
							}
							else if (currentSetting == "[IgnoredSpells]")
							{
								std::string variableName;
								std::string variableValue = GetConfigSettingsStringValue(line, variableName);
								if (variableValue == "0")
									ignoredSpells.emplace_back(variableName);
								else
									shortSpells.emplace_back(variableName);
							}
						}
					}
				}
			}
			_MESSAGE("Config file is loaded successfully.");
			return;
		}

		_MESSAGE("Config file is not loaded.");
		return;
	}

	void Log(const int msgLogLevel, const char* fmt, ...)
	{
		if (msgLogLevel > logging)
		{
			return;
		}

		va_list args;
		char logBuffer[4096];

		va_start(args, fmt);
		vsprintf_s(logBuffer, sizeof(logBuffer), fmt, args);
		va_end(args);

		_MESSAGE(logBuffer);
	}



}